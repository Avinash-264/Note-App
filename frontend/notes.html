<!DOCTYPE html>
<html>
  <head>
    <title>Your Notes</title>
    <link rel="stylesheet" href="note.css" />
  </head>
  <body>
    <div class="container">
      <h2>Your Notes</h2>
      <textarea id="noteInput" placeholder="Write your note..."></textarea>
      <button onclick="addNote()">Add Note</button>
      <button onclick="logout()">Logout</button>
      <div id="notesList"></div>
    </div>

    <script>
      let editingNoteId = null;

      const token = localStorage.getItem("token");
      if (!token) {
        window.location.href = "index.html"; // ‚ùå Not logged in ‚Üí go back
      }

      async function fetchNotes() {
        const res = await fetch("/api/notes", {
          headers: {
            Authorization: `Bearer ${token}`,
          },
        });

        const data = await res.json();
        const notesList = document.getElementById("notesList");
        notesList.innerHTML = "";

        data.forEach((note) => {
          const div = document.createElement("div");
          div.classList.add("note-item");

          const p = document.createElement("p");
          p.innerText = note.content;
          div.appendChild(p);

          const deleteBtn = document.createElement("button");
          deleteBtn.innerText = "Delete";
          deleteBtn.onclick = () => deleteNote(note._id);
          div.appendChild(deleteBtn);

          const editBtn = document.createElement("button");
          editBtn.innerText = "Edit";
          editBtn.onclick = () => editNote(note._id, note.content);
          div.appendChild(editBtn);

          notesList.appendChild(div);
        });
      }

      async function addNote() {
        const content = document.getElementById("noteInput").value;

        if (!content.trim()) return alert("Note cannot be empty.");

        if (editingNoteId) {
          // ‚úèÔ∏è Editing existing note
          await fetch(`/api/notes/${editingNoteId}`, {
            method: "PUT",
            headers: {
              "Content-Type": "application/json",
              Authorization: `Bearer ${token}`,
            },
            body: JSON.stringify({ content }),
          });
          editingNoteId = null;
        } else {
          // ‚ûï Creating new note
          await fetch("/api/notes", {
            method: "POST",
            headers: {
              "Content-Type": "application/json",
              Authorization: `Bearer ${token}`,
            },
            body: JSON.stringify({ content }),
          });
        }

        document.getElementById("noteInput").value = "";
        fetchNotes();
      }

      async function deleteNote(id) {
        if (confirm("Are you sure you want to delete this note?")) {
          await fetch(`/api/notes/${id}`, {
            method: "DELETE",
            headers: {
              Authorization: `Bearer ${token}`,
            },
          });
          fetchNotes();
        }
      }

      function editNote(id, content) {
        document.getElementById("noteInput").value = content;
        editingNoteId = id;
      }

      function logout() {
        localStorage.removeItem("token");
        window.location.href = "index.html";
      }

      fetchNotes(); // üì• Load notes when page opens
    </script>
  </body>
</html>
